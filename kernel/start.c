#include <n7OS/cpu.h>
#include <inttypes.h>
#include <n7OS/processor_structs.h>
#include <n7OS/console.h>
#include <n7OS/irq.h>
#include <n7OS/time.h>
#include <unistd.h>
#include <n7OS/sys.h>
#include <stdio.h>

extern void handler_50();

void kernel_start(void)
{
    // Initialisation des interruptions
    init_irq_entry(50, (uint32_t)handler_50);
    sti();

    // Initialisation de la console
    console_init();

    // Initialisation du timer
    init_timer();

    // Initialisation des appels systèmes
    init_syscall();

    printf("%d", example()); // 0 ??
    if (example() == 1)
    {
        printf("Appel Système exemple OK");
    }

    // on ne doit jamais sortir de kernel_start
    while (1)
    {
        // __asm__("int $50" ::); test de l'interruption 50 (OK)

        // cette fonction arrete le processeur
        hlt();
    }
}
